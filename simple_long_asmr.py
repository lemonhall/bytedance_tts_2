#!/usr/bin/env python3
"""
简化版长ASMR生成器 - 直接输出完整MP3
基于最佳参数配置，生成单个长时间MP3文件
"""
from tts_http_v3 import TTSHttpClient
import os

# 推荐使用豆包TTS 2.0音色
DEFAULT_SPEAKER = os.getenv("VOLCENGINE_VOICE_TYPE", "zh_female_vv_uranus_bigtts")

# 最佳ASMR参数配置
BEST_ASMR_CONFIG = {
    "emotion": "ASMR",
    "emotion_scale": 5,
    "speech_rate": -2,
    "loudness_rate": -3,
    "audio_format": "mp3",
    "sample_rate": 24000,
    "bit_rate": 128
}

# 最佳上下文设置
BEST_ASMR_CONTEXT = ["用最亲密的ASMR耳语声", "就像情侣间的悄悄话", "声音要很贴近"]

def generate_single_long_asmr():
    """生成单个长时间ASMR音频"""
    
    # 长文案 - 约10分钟助眠内容
    long_asmr_text = """
    轻轻地闭上你的眼睛...深深地吸一口气...慢慢地呼出来...让所有的紧张和压力...都随着呼吸...慢慢地离开你的身体...

    夜已经很深了...外面的世界都安静下来了...这是属于你的宁静时光...让心灵得到真正的休息...

    现在...让我们开始一段放松的旅程...感受你的身体...从头部开始...慢慢地放松下来...你的额头...变得平滑...没有任何紧张...

    你的眼皮...轻轻地合拢...感受这份安宁...你的脸颊...柔软而温暖...所有的表情都消失了...你的嘴唇...微微分开...呼吸变得更加深沉...

    现在让这份放松...延伸到你的肩膀...感受肩膀的重量...慢慢地沉下去...就像卸下了一天的负担...你的手臂...变得越来越重...越来越放松...

    手指...轻轻地摊开...没有任何紧张...这份放松...现在流向你的胸部...你的呼吸...变得更加缓慢...更加深沉...

    感受每一次呼吸...都带来更深的宁静...你的心跳...也变得平缓而规律...像大自然最温柔的节拍...

    想象你正在走进一个宁静的森林...这里有高大的树木...茂密的绿叶...空气清新而纯净...每一次呼吸...都让你感到更加放松...

    你沿着一条小径慢慢地走着...脚下是柔软的落叶...发出轻微的沙沙声...这声音让你感到无比的平静...

    在森林的深处...有一个清澈的小溪...水声潺潺...像最温柔的摇篮曲...你坐在溪边的一块平滑的石头上...感受大自然的宁静...

    微风轻拂过树梢...带来花草的清香...鸟儿偶尔传来轻柔的鸣叫声...一切都是那么和谐...那么宁静...

    在这个森林里...时间仿佛停止了...没有任何压力...没有任何烦恼...只有纯粹的宁静和放松...

    你的背部...现在完全地贴着舒适的表面...所有的肌肉都放松了...腰部...臀部...也都加入了这场放松的旅程...

    现在...让这份宁静...流向你的双腿...大腿...小腿...都变得沉重而放松...你的脚踝...脚趾...也都完全地放松了...

    现在...你的整个身体...都沉浸在这份深深的宁静中...就像漂浮在温暖的云朵上...无忧无虑...

    月光透过树叶的缝隙...洒在你的身上...带来一种温和的光辉...这光辉有治愈的力量...慢慢地渗透到你的每一个细胞...

    感受这份完美的平静...让它充满你的整个存在...在这个安全的空间里...你可以完全地释放自己...

    没有什么需要你担心...没有什么需要你思考...只需要享受这份纯粹的宁静...和深深的放松...

    你的呼吸...现在变得非常缓慢...非常深沉...每一次呼气...都带走更多的紧张...每一次吸气...都带来更深的平静...

    让你的意识...慢慢地沉入这份宁静之中...就像沉入温暖的海洋...感受那种被轻柔地包围的感觉...

    在这个宁静的森林里...你找到了内心的平衡...所有的焦虑都消散了...所有的疲惫都消失了...

    你感到前所未有的轻松...前所未有的平静...这种感觉会伴随你进入梦乡...让你的睡眠变得深沉而甜美...

    现在...让你的呼吸...成为通往梦境的桥梁...每一次呼吸...都让你更接近那个宁静的梦乡...

    在那里...有最美好的风景...最温柔的声音...最舒适的环境...你将在那里得到最充分的休息...

    让这份宁静...深深地印在你的记忆里...每当你需要放松的时候...你都可以回到这个森林...回到这份宁静...

    现在...慢慢地...让你的意识...沉入更深的宁静之中...感受那种被温柔包围的感觉...让它带你进入甜美的梦乡...

    愿这份宁静...伴随你整个夜晚...愿你的梦境...充满美好和平静...愿你醒来时...感到精神焕发...充满活力...

    现在...安心地睡吧...在这份深深的宁静中...进入最甜美的梦乡...晚安...
    """
    
    client = TTSHttpClient()
    
    try:
        print(f"\n🎧 生成长时间助眠ASMR音频")
        print(f"📝 文本长度: {len(long_asmr_text)} 字符")
        print(f"📁 输出文件: long_asmr_sleep_relaxation.mp3")
        print(f"🎵 使用音色: {DEFAULT_SPEAKER}")
        print(f"⚙️ 参数配置: {BEST_ASMR_CONFIG}")
        print("=" * 60)
        
        success = client.synthesize_speech(
            text=long_asmr_text.strip(),
            output_file="long_asmr_sleep_relaxation.mp3",
            speaker=DEFAULT_SPEAKER,
            context_texts=BEST_ASMR_CONTEXT,
            **BEST_ASMR_CONFIG
        )
        
        if success:
            print(f"\n✅ 长时间助眠ASMR音频生成成功!")
            print(f"📁 文件: long_asmr_sleep_relaxation.mp3")
            print(f"💡 建议睡前使用耳机聆听，有助于放松入眠")
        else:
            print(f"❌ 生成失败")
            
    except Exception as e:
        print(f"❌ 生成过程出错: {e}")
    finally:
        client.close()


if __name__ == "__main__":
    # 检查环境配置
    if not os.getenv("VOLCENGINE_APP_ID") or not os.getenv("VOLCENGINE_ACCESS_TOKEN"):
        print("❌ 请先配置火山引擎TTS API密钥!")
        print("请在.env文件中设置:")
        print("VOLCENGINE_APP_ID=你的AppID")
        print("VOLCENGINE_ACCESS_TOKEN=你的AccessToken")
        exit(1)
    
    generate_single_long_asmr()