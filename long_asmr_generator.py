#!/usr/bin/env python3
"""
é•¿æ—¶é—´ASMRéŸ³é¢‘ç”Ÿæˆå™¨ - è±†åŒ…TTS 2.0
åŸºäºæœ€ä½³å‚æ•°é…ç½®ï¼Œç”Ÿæˆé•¿æ—¶é—´çš„MP3æ ¼å¼ASMRéŸ³é¢‘
ä½¿ç”¨"äº²å¯†è€³è¯­"åœºæ™¯çš„ultra_softé…ç½®
"""
from tts_http_v3 import TTSHttpClient
import os
from pathlib import Path
import time

# æ¨èä½¿ç”¨è±†åŒ…TTS 2.0éŸ³è‰²
DEFAULT_SPEAKER = os.getenv("VOLCENGINE_VOICE_TYPE", "zh_female_vv_uranus_bigtts")

# æœ€ä½³ASMRå‚æ•°é…ç½®ï¼ˆåŸºäºäº²å¯†è€³è¯­åœºæ™¯çš„ultra_softé…ç½®ï¼‰
BEST_ASMR_CONFIG = {
    "emotion": "ASMR",
    "emotion_scale": 5,
    "speech_rate": -2,  # æ›´æ…¢çš„è¯­é€Ÿ
    "loudness_rate": -3,  # æ›´è½»çš„éŸ³é‡
    "audio_format": "mp3",  # è¾“å‡ºMP3æ ¼å¼
    "sample_rate": 24000,
    "bit_rate": 128  # MP3æ¯”ç‰¹ç‡
}

# æœ€ä½³ASMRä¸Šä¸‹æ–‡è®¾ç½®
BEST_ASMR_CONTEXT = ["ç”¨æœ€äº²å¯†çš„ASMRè€³è¯­å£°", "å°±åƒæƒ…ä¾£é—´çš„æ‚„æ‚„è¯", "å£°éŸ³è¦å¾ˆè´´è¿‘"]

# é•¿æ—¶é—´ASMRæ–‡æ¡ˆ - é€‚åˆ10åˆ†é’ŸéŸ³é¢‘
LONG_ASMR_SCRIPTS = {
    "æ·±åº¦æ”¾æ¾å†¥æƒ³": [
        "é—­ä¸Šä½ çš„çœ¼ç›...æ·±æ·±åœ°å¸ä¸€å£æ°”...æ…¢æ…¢åœ°å‘¼å‡ºæ¥...",
        "è®©æ‰€æœ‰çš„ç´§å¼ å’Œå‹åŠ›...éƒ½éšç€å‘¼å¸...æ…¢æ…¢åœ°ç¦»å¼€ä½ çš„èº«ä½“...",
        "æ„Ÿå—ä½ çš„è‚Œè‚‰...ä»å¤´éƒ¨å¼€å§‹...æ…¢æ…¢åœ°æ”¾æ¾ä¸‹æ¥...",
        "ä½ çš„é¢å¤´...å˜å¾—å¹³æ»‘...æ²¡æœ‰ä»»ä½•ç´§å¼ ...",
        "ä½ çš„çœ¼çš®...è½»è½»åœ°åˆæ‹¢...æ„Ÿå—è¿™ä»½å®é™...",
        "ä½ çš„è„¸é¢Š...æŸ”è½¯è€Œæ¸©æš–...æ‰€æœ‰çš„è¡¨æƒ…éƒ½æ¶ˆå¤±äº†...",
        "ä½ çš„å˜´å”‡...å¾®å¾®åˆ†å¼€...å‘¼å¸å˜å¾—æ›´åŠ æ·±æ²‰...",
        "ç°åœ¨è®©è¿™ä»½æ”¾æ¾...å»¶ä¼¸åˆ°ä½ çš„è‚©è†€...",
        "æ„Ÿå—è‚©è†€çš„é‡é‡...æ…¢æ…¢åœ°æ²‰ä¸‹å»...",
        "ä½ çš„æ‰‹è‡‚...å˜å¾—è¶Šæ¥è¶Šé‡...è¶Šæ¥è¶Šæ”¾æ¾...",
        "æ‰‹æŒ‡...è½»è½»åœ°æ‘Šå¼€...æ²¡æœ‰ä»»ä½•ç´§å¼ ...",
        "è¿™ä»½æ”¾æ¾...ç°åœ¨æµå‘ä½ çš„èƒ¸éƒ¨...",
        "ä½ çš„å‘¼å¸...å˜å¾—æ›´åŠ ç¼“æ…¢...æ›´åŠ æ·±æ²‰...",
        "æ„Ÿå—æ¯ä¸€æ¬¡å‘¼å¸...éƒ½å¸¦æ¥æ›´æ·±çš„å®é™...",
        "ä½ çš„èƒŒéƒ¨...è´´ç€èˆ’é€‚çš„è¡¨é¢...å®Œå…¨åœ°æ”¾æ¾...",
        "è…°éƒ¨...è‡€éƒ¨...ä¹Ÿéƒ½åŠ å…¥äº†è¿™åœºæ”¾æ¾çš„æ—…ç¨‹...",
        "ç°åœ¨...è®©è¿™ä»½å®é™...æµå‘ä½ çš„åŒè…¿...",
        "å¤§è…¿...å°è…¿...éƒ½å˜å¾—æ²‰é‡è€Œæ”¾æ¾...",
        "ä½ çš„è„šè¸...è„šè¶¾...ä¹Ÿéƒ½å®Œå…¨åœ°æ”¾æ¾äº†...",
        "ç°åœ¨...ä½ çš„æ•´ä¸ªèº«ä½“...éƒ½æ²‰æµ¸åœ¨è¿™ä»½æ·±æ·±çš„å®é™ä¸­...",
        "ä½ å°±åƒæ¼‚æµ®åœ¨æ¸©æš–çš„äº‘æœµä¸Š...æ— å¿§æ— è™‘...",
        "æ„Ÿå—è¿™ä»½å®Œç¾çš„å¹³é™...è®©å®ƒå……æ»¡ä½ çš„æ•´ä¸ªå­˜åœ¨...",
        "åœ¨è¿™ä¸ªå®‰å…¨çš„ç©ºé—´é‡Œ...ä½ å¯ä»¥å®Œå…¨åœ°é‡Šæ”¾è‡ªå·±...",
        "æ²¡æœ‰ä»€ä¹ˆéœ€è¦ä½ æ‹…å¿ƒ...æ²¡æœ‰ä»€ä¹ˆéœ€è¦ä½ æ€è€ƒ...",
        "åªéœ€è¦äº«å—è¿™ä»½çº¯ç²¹çš„å®é™...å’Œæ·±æ·±çš„æ”¾æ¾...",
        "è®©æˆ‘çš„å£°éŸ³...æˆä¸ºä½ å†…å¿ƒå¹³é™çš„é”šç‚¹...",
        "æ¯å½“ä½ å¬åˆ°è¿™ä¸ªå£°éŸ³...ä½ å°±ä¼šæƒ³èµ·è¿™ä»½å®é™...",
        "è¿™ä»½å¹³é™...å°†ä¼šä¼´éšä½ å¾ˆä¹…å¾ˆä¹…...",
        "å³ä½¿åœ¨ä½ çå¼€çœ¼ç›ä¹‹å...è¿™ä»½å®é™ä»ç„¶åœ¨é‚£é‡Œ...",
        "ç°åœ¨...è®©æˆ‘ä»¬ä¸€èµ·...åœ¨è¿™ä»½ç¾å¥½ä¸­...å®‰é™åœ°åœç•™ä¸€ä¼šå„¿..."
    ],
    
    "æ¸©æŸ”é™ªä¼´å¤œè¯­": [
        "å¤œå·²ç»å¾ˆæ·±äº†...å¤–é¢çš„ä¸–ç•Œéƒ½å®‰é™ä¸‹æ¥äº†...",
        "åªæœ‰æˆ‘ä»¬ä¸¤ä¸ªäººçš„æ—¶å…‰...å¤šä¹ˆçè´µ...",
        "ä½ ä»Šå¤©ä¸€å®šå¾ˆè¾›è‹¦å§...è®©æˆ‘é™ªä¼´ä½ ä¸€ä¼šå„¿...",
        "æŠŠä½ çš„å¤´...è½»è½»åœ°é åœ¨æˆ‘çš„è‚©è†€ä¸Š...",
        "æ„Ÿå—è¿™ä»½æ¸©æš–...è¿™ä»½å®‰å…¨æ„Ÿ...",
        "ä½ çŸ¥é“å—...ä½ åœ¨æˆ‘å¿ƒä¸­æœ‰å¤šä¹ˆç‰¹åˆ«...",
        "ä½ çš„æ¯ä¸€ä¸ªå¾®ç¬‘...éƒ½åƒæ˜Ÿæ˜Ÿä¸€æ ·é—ªäº®...",
        "ä½ çš„æ¯ä¸€æ¬¡å‘¼å¸...éƒ½è®©æˆ‘æ„Ÿåˆ°å®‰å¿ƒ...",
        "åœ¨è¿™ä¸ªå®é™çš„å¤œæ™š...æˆ‘æƒ³å‘Šè¯‰ä½ ä¸€äº›ç§˜å¯†...",
        "æˆ‘å–œæ¬¢ä½ ä¸“æ³¨æ—¶çš„æ ·å­...é‚£ä¹ˆè®¤çœŸ...é‚£ä¹ˆç¾ä¸½...",
        "æˆ‘å–œæ¬¢ä½ ç¬‘èµ·æ¥çš„å£°éŸ³...åƒé“¶é“ƒä¸€æ ·æ¸…è„†...",
        "æˆ‘å–œæ¬¢ä½ å®‰é™æ—¶çš„æ¨¡æ ·...é‚£ä¹ˆå¹³å’Œ...é‚£ä¹ˆåŠ¨äºº...",
        "æœˆå…‰é€è¿‡çª—å¸˜...æ´’åœ¨ä½ çš„è„¸ä¸Š...",
        "å°±åƒå¤©ä½¿èº«ä¸Šçš„å…‰ç¯...é‚£ä¹ˆæŸ”å’Œ...",
        "ä½ çŸ¥é“å—...æœ‰ä½ åœ¨èº«è¾¹...æˆ‘å°±ä¸æ€•é»‘å¤œ...",
        "å› ä¸ºä½ å°±æ˜¯æˆ‘å¿ƒä¸­æœ€äº®çš„é‚£é¢—æ˜Ÿ...",
        "åœ¨è¿™ä¸ªä¸–ç•Œä¸Š...èƒ½é‡åˆ°ä½ ...æ˜¯æˆ‘æœ€å¤§çš„å¹¸è¿...",
        "è®©æˆ‘è½»è½»åœ°æŠšæ‘¸ä½ çš„å¤´å‘...æ„Ÿå—å®ƒçš„æŸ”è½¯...",
        "è®©æˆ‘è½»è½»åœ°äº²å»ä½ çš„é¢å¤´...è¡¨è¾¾æˆ‘çš„çˆ±æ„...",
        "ä¸è¦æ‹…å¿ƒæ˜å¤©ä¼šå‘ç”Ÿä»€ä¹ˆ...ä»Šæ™šæˆ‘ä»¬å°±åœ¨è¿™é‡Œ...",
        "é™é™åœ°äº«å—è¿™ä»½ç¾å¥½...è¿™ä»½åªå±äºæˆ‘ä»¬çš„æ—¶å…‰...",
        "å¬ç€æˆ‘çš„å¿ƒè·³...å®ƒåœ¨ä¸ºä½ è€Œè·³åŠ¨...",
        "å¬ç€æˆ‘çš„å‘¼å¸...å®ƒåœ¨å’Œä½ åŒæ­¥...",
        "æˆ‘ä»¬å°±è¿™æ ·...ç´§ç´§åœ°æ‹¥æŠ±ç€...",
        "è®©çˆ±æ„...åœ¨è¿™ä¸ªå®‰é™çš„å¤œæ™š...æ…¢æ…¢åœ°æµæ·Œ...",
        "ç›´åˆ°æˆ‘ä»¬ä¸€èµ·...åœ¨è¿™ä»½ç”œèœœä¸­...è¿›å…¥æ¢¦ä¹¡..."
    ],
    
    "ç–—æ„ˆå¿ƒçµèŠ±å›­": [
        "æƒ³è±¡ä½ æ­£åœ¨èµ°è¿›ä¸€ä¸ªç¾ä¸½çš„èŠ±å›­...",
        "è¿™é‡Œæœ‰ä½ è§è¿‡çš„æœ€ç¾ä¸½çš„èŠ±æœµ...æœ€ç»¿çš„è‰åœ°...",
        "ç©ºæ°”ä¸­é£˜æ•£ç€æ·¡æ·¡çš„èŠ±é¦™...é‚£ä¹ˆæ¸…æ–°...é‚£ä¹ˆæ€¡äºº...",
        "ä½ èµ¤è„šèµ°åœ¨æŸ”è½¯çš„è‰åœ°ä¸Š...æ„Ÿå—å¤§åœ°çš„æ¸©åº¦...",
        "æ¯ä¸€æ­¥éƒ½è®©ä½ æ„Ÿåˆ°æ›´åŠ æ”¾æ¾...æ›´åŠ å¹³é™...",
        "åœ¨èŠ±å›­çš„ä¸­å¤®...æœ‰ä¸€ä¸ªæ¸…æ¾ˆçš„å°æ± å¡˜...",
        "æ± æ°´åƒé•œå­ä¸€æ ·...å€’æ˜ ç€è“å¤©ç™½äº‘...",
        "ä½ æ…¢æ…¢åœ°ååœ¨æ± è¾¹...æ„Ÿå—æ°´çš„å®é™...",
        "å¾®é£è½»æ‹‚è¿‡ä½ çš„è„¸é¢Š...å¸¦æ¥èŠ±æœµçš„é¦™æ°”...",
        "é¸Ÿå„¿åœ¨æ ‘æ¢¢ä¸Šè½»å£°æ­Œå”±...é‚£ä¹ˆæ‚¦è€³...é‚£ä¹ˆå’Œè°...",
        "åœ¨è¿™ä¸ªèŠ±å›­é‡Œ...æ‰€æœ‰çš„çƒ¦æ¼éƒ½ä¸å­˜åœ¨äº†...",
        "è¿™é‡Œåªæœ‰ç¾å¥½...åªæœ‰å¹³é™...åªæœ‰çˆ±...",
        "ä½ æ„Ÿåˆ°å¿ƒä¸­çš„é‚£äº›åˆ›ä¼¤...æ­£åœ¨æ…¢æ…¢åœ°æ„ˆåˆ...",
        "å°±åƒèŠ±æœµåœ¨é˜³å…‰ä¸‹ç»½æ”¾ä¸€æ ·...è‡ªç„¶è€Œç¾ä¸½...",
        "ä½ å†…å¿ƒçš„å°å­©...åœ¨è¿™é‡Œæ‰¾åˆ°äº†å®‰å…¨æ„Ÿ...",
        "å®ƒå¯ä»¥è‡ªç”±åœ°å¥”è·‘...è‡ªç”±åœ°ç¬‘...è‡ªç”±åœ°å“­...",
        "æ‰€æœ‰è¢«å‹æŠ‘çš„æƒ…æ„Ÿ...éƒ½å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°é‡Šæ”¾...",
        "ä½ ä¸éœ€è¦åšå¼º...ä¸éœ€è¦å®Œç¾...ä¸éœ€è¦è®¨å¥½ä»»ä½•äºº...",
        "åœ¨è¿™ä¸ªèŠ±å›­é‡Œ...ä½ åªéœ€è¦åšçœŸå®çš„è‡ªå·±...",
        "æ„Ÿå—é˜³å…‰æ´’åœ¨ä½ çš„è‚©è†€ä¸Š...æ¸©æš–è€Œæ²»æ„ˆ...",
        "æ„Ÿå—è¿™ä»½æ— æ¡ä»¶çš„æ¥çº³...æ— æ¡ä»¶çš„çˆ±...",
        "ä½ æ˜¯å€¼å¾—è¢«çˆ±çš„...ä½ æ˜¯çè´µçš„...ä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„...",
        "è®©è¿™ä»½çˆ±...æ…¢æ…¢åœ°å……æ»¡ä½ çš„å¿ƒæˆ¿...",
        "è®©å®ƒæ²»æ„ˆä½ çš„æ¯ä¸€ä¸ªç»†èƒ...æ¯ä¸€ä¸ªå¿µå¤´...",
        "ç°åœ¨...æ·±æ·±åœ°å‘¼å¸...å¸å…¥è¿™ä»½çˆ±å’Œå…‰æ˜...",
        "å‘¼å‡ºæ‰€æœ‰çš„ææƒ§å’Œç—›è‹¦...",
        "ä½ å·²ç»å‡†å¤‡å¥½...å¸¦ç€è¿™ä»½æ–°çš„èƒ½é‡...é‡æ–°å¼€å§‹...",
        "è¿™ä¸ªèŠ±å›­...æ°¸è¿œä¸ºä½ å¼€æ”¾...ä½ éšæ—¶å¯ä»¥å›æ¥..."
    ]
}


def generate_long_asmr_mp3(script_name: str, output_filename: str = None):
    """
    ç”Ÿæˆé•¿æ—¶é—´çš„ASMR MP3éŸ³é¢‘
    
    Args:
        script_name: è„šæœ¬åç§°
        output_filename: è¾“å‡ºæ–‡ä»¶åï¼ˆå¯é€‰ï¼‰
    """
    if script_name not in LONG_ASMR_SCRIPTS:
        print(f"âŒ æœªæ‰¾åˆ°è„šæœ¬: {script_name}")
        print(f"å¯ç”¨è„šæœ¬: {list(LONG_ASMR_SCRIPTS.keys())}")
        return False
    
    if not output_filename:
        output_filename = f"long_asmr_{script_name}.mp3"
    
    script_texts = LONG_ASMR_SCRIPTS[script_name]
    client = TTSHttpClient()
    
    try:
        print(f"\nğŸ§ å¼€å§‹ç”Ÿæˆé•¿æ—¶é—´ASMRéŸ³é¢‘")
        print(f"ğŸ“‹ è„šæœ¬: {script_name}")
        print(f"ğŸ“ æ®µè½æ•°: {len(script_texts)}")
        print(f"ğŸ“ è¾“å‡ºæ–‡ä»¶: {output_filename}")
        print(f"ğŸµ éŸ³è‰²: {DEFAULT_SPEAKER}")
        print("=" * 60)
        
        # ä¼°ç®—æ€»æ—¶é•¿ï¼ˆæ¯ä¸ªæ®µè½å¤§çº¦15-25ç§’ï¼‰
        estimated_duration = len(script_texts) * 20 / 60
        print(f"â±ï¸ é¢„ä¼°æ—¶é•¿: {estimated_duration:.1f} åˆ†é’Ÿ")
        
        success_count = 0
        total_segments = len(script_texts)
        
        for i, text in enumerate(script_texts, 1):
            # ä¸ºæ¯ä¸ªæ®µè½ç”Ÿæˆä¸´æ—¶æ–‡ä»¶
            temp_filename = f"temp_asmr_segment_{i:03d}.mp3"
            
            print(f"\nğŸµ ç”Ÿæˆæ®µè½ {i}/{total_segments}: {text[:30]}...")
            
            success = client.synthesize_speech(
                text=text,
                output_file=temp_filename,
                speaker=DEFAULT_SPEAKER,
                context_texts=BEST_ASMR_CONTEXT,
                **BEST_ASMR_CONFIG
            )
            
            if success:
                print(f"âœ… æ®µè½ {i} æˆåŠŸ")
                success_count += 1
            else:
                print(f"âŒ æ®µè½ {i} å¤±è´¥")
                
            # æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
            time.sleep(0.5)
        
        print(f"\nğŸ“Š éŸ³é¢‘ç”Ÿæˆå®Œæˆ!")
        print(f"âœ… æˆåŠŸæ®µè½: {success_count}/{total_segments}")
        
        if success_count > 0:
            print(f"\nğŸ’¡ æ¥ä¸‹æ¥éœ€è¦æ‰‹åŠ¨åˆå¹¶MP3æ–‡ä»¶:")
            print(f"1. ä½¿ç”¨éŸ³é¢‘ç¼–è¾‘è½¯ä»¶ï¼ˆå¦‚Audacityï¼‰")
            print(f"2. æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·åˆå¹¶æ‰€æœ‰ temp_asmr_segment_*.mp3")
            print(f"3. æœ€ç»ˆè¾“å‡ºä¸º: {output_filename}")
            
            # ç”Ÿæˆåˆå¹¶è„šæœ¬
            generate_merge_script(success_count, output_filename)
        
        return success_count == total_segments
        
    except Exception as e:
        print(f"âŒ ç”Ÿæˆè¿‡ç¨‹å‡ºé”™: {e}")
        return False
    finally:
        client.close()


def generate_merge_script(segment_count: int, output_filename: str):
    """ç”ŸæˆéŸ³é¢‘åˆå¹¶è„šæœ¬"""
    
    # PowerShellè„šæœ¬
    ps_script = f"""# ASMRéŸ³é¢‘åˆå¹¶è„šæœ¬ - PowerShellç‰ˆæœ¬
# éœ€è¦å…ˆå®‰è£…ffmpeg: https://ffmpeg.org/

$segments = @()
for ($i = 1; $i -le {segment_count}; $i++) {{
    $filename = "temp_asmr_segment_" + $i.ToString("000") + ".mp3"
    if (Test-Path $filename) {{
        $segments += "file '$filename'"
    }}
}}

# åˆ›å»ºæ–‡ä»¶åˆ—è¡¨
$segments | Out-File -FilePath "filelist.txt" -Encoding UTF8

# ä½¿ç”¨ffmpegåˆå¹¶
ffmpeg -f concat -safe 0 -i filelist.txt -c copy "{output_filename}"

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
Remove-Item "filelist.txt"
Write-Host "åˆå¹¶å®Œæˆ: {output_filename}"
"""
    
    with open("merge_asmr_audio.ps1", "w", encoding="utf-8") as f:
        f.write(ps_script)
    
    # æ‰¹å¤„ç†è„šæœ¬
    bat_script = f"""@echo off
REM ASMRéŸ³é¢‘åˆå¹¶è„šæœ¬ - æ‰¹å¤„ç†ç‰ˆæœ¬
REM éœ€è¦å…ˆå®‰è£…ffmpeg

echo æ­£åœ¨åˆ›å»ºæ–‡ä»¶åˆ—è¡¨...
(
"""
    
    for i in range(1, segment_count + 1):
        bat_script += f'echo file "temp_asmr_segment_{i:03d}.mp3"\n'
    
    bat_script += f""") > filelist.txt

echo æ­£åœ¨åˆå¹¶éŸ³é¢‘...
ffmpeg -f concat -safe 0 -i filelist.txt -c copy "{output_filename}"

echo æ¸…ç†ä¸´æ—¶æ–‡ä»¶...
del filelist.txt

echo åˆå¹¶å®Œæˆ: {output_filename}
pause
"""
    
    with open("merge_asmr_audio.bat", "w", encoding="gbk") as f:
        f.write(bat_script)
    
    print(f"\nğŸ“œ å·²ç”Ÿæˆåˆå¹¶è„šæœ¬:")
    print(f"   - merge_asmr_audio.ps1 (PowerShellç‰ˆæœ¬)")
    print(f"   - merge_asmr_audio.bat (æ‰¹å¤„ç†ç‰ˆæœ¬)")
    print(f"ğŸ’¡ è¿è¡Œå…¶ä¸­ä»»ä¸€è„šæœ¬å³å¯åˆå¹¶éŸ³é¢‘")


def interactive_long_asmr_generator():
    """äº¤äº’å¼é•¿æ—¶é—´ASMRç”Ÿæˆå™¨"""
    print("\nğŸ§ é•¿æ—¶é—´ASMRéŸ³é¢‘ç”Ÿæˆå™¨")
    print("=" * 50)
    
    while True:
        print(f"\nğŸ“‹ å¯ç”¨ASMRè„šæœ¬:")
        for i, script_name in enumerate(LONG_ASMR_SCRIPTS.keys(), 1):
            script_texts = LONG_ASMR_SCRIPTS[script_name]
            estimated_duration = len(script_texts) * 20 / 60
            print(f"{i}. {script_name} (çº¦ {estimated_duration:.1f} åˆ†é’Ÿ)")
        
        print("0. é€€å‡º")
        
        choice = input("\nè¯·é€‰æ‹©è„šæœ¬ (0-3): ").strip()
        
        if choice == "0":
            print("ğŸ‘‹ å†è§!")
            break
            
        try:
            script_idx = int(choice) - 1
            script_names = list(LONG_ASMR_SCRIPTS.keys())
            
            if 0 <= script_idx < len(script_names):
                script_name = script_names[script_idx]
                
                # è¯¢é—®è¾“å‡ºæ–‡ä»¶å
                output_name = input(f"è¾“å‡ºæ–‡ä»¶å (é»˜è®¤: long_asmr_{script_name}.mp3): ").strip()
                if not output_name:
                    output_name = f"long_asmr_{script_name}.mp3"
                
                # ç¡®è®¤ç”Ÿæˆ
                script_texts = LONG_ASMR_SCRIPTS[script_name]
                estimated_duration = len(script_texts) * 20 / 60
                print(f"\nğŸ“ å³å°†ç”Ÿæˆ:")
                print(f"   è„šæœ¬: {script_name}")
                print(f"   æ®µè½æ•°: {len(script_texts)}")
                print(f"   é¢„ä¼°æ—¶é•¿: {estimated_duration:.1f} åˆ†é’Ÿ")
                print(f"   è¾“å‡ºæ–‡ä»¶: {output_name}")
                
                confirm = input("ç¡®è®¤ç”Ÿæˆ? (y/N): ").strip().lower()
                if confirm in ['y', 'yes']:
                    generate_long_asmr_mp3(script_name, output_name)
                else:
                    print("âŒ å·²å–æ¶ˆ")
            else:
                print("âŒ æ— æ•ˆçš„è„šæœ¬ç¼–å·")
                
        except ValueError:
            print("âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—")


if __name__ == "__main__":
    # æ£€æŸ¥ç¯å¢ƒé…ç½®
    if not os.getenv("VOLCENGINE_APP_ID") or not os.getenv("VOLCENGINE_ACCESS_TOKEN"):
        print("âŒ è¯·å…ˆé…ç½®ç«å±±å¼•æ“TTS APIå¯†é’¥!")
        print("è¯·åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®:")
        print("VOLCENGINE_APP_ID=ä½ çš„AppID")
        print("VOLCENGINE_ACCESS_TOKEN=ä½ çš„AccessToken")
        exit(1)
    
    # å¯åŠ¨äº¤äº’å¼ç”Ÿæˆå™¨
    interactive_long_asmr_generator()