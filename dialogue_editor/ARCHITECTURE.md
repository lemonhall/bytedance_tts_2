# å¯¹è¯TTSç¼–è¾‘å™¨ - é¡¹ç›®æ€»è§ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºWebçš„å¯è§†åŒ–å¯¹è¯TTSç¼–è¾‘å™¨,ç”¨äºå¿«é€Ÿåˆ›å»ºå¤šäººå¯¹è¯çš„è¯­éŸ³åˆæˆå·¥ç¨‹ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **æ™ºèƒ½åˆ†æ**: è¾“å…¥çº¯æ–‡æœ¬å¯¹è¯,AIè‡ªåŠ¨è¯†åˆ«è¯´è¯äººã€æ€§åˆ«ã€å¹´é¾„å’Œæƒ…æ„Ÿ
2. **å¯è§†åŒ–ç¼–è¾‘**: Webç•Œé¢å®æ—¶è°ƒæ•´æ‰€æœ‰TTSå‚æ•°
3. **æ‰¹é‡ç”Ÿæˆ**: ä¸€é”®ç”Ÿæˆæ•´æ®µå¯¹è¯éŸ³é¢‘å¹¶è‡ªåŠ¨æ‹¼æ¥
4. **å·¥ç¨‹ç®¡ç†**: ä¿å­˜/åŠ è½½å·¥ç¨‹æ–‡ä»¶,æ”¯æŒé‡æ–°ç”Ÿæˆå•å¥

### è®¾è®¡äº®ç‚¹

- âœ… **è½»é‡çº§**: Pythonåç«¯ä»…3ä¸ªæ ¸å¿ƒä¾èµ–(FastAPI + Pydantic + Uvicorn)
- âœ… **æ— æ¡†æ¶å‰ç«¯**: çº¯JavaScript,æ— éœ€npm/webpackç­‰æ„å»ºå·¥å…·
- âœ… **ç¾è§‚ç•Œé¢**: ç°ä»£åŒ–Material Designé£æ ¼,å“åº”å¼å¸ƒå±€
- âœ… **å·¥ç¨‹åŒ–**: JSONæ ¼å¼å·¥ç¨‹æ–‡ä»¶,ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œåˆ†äº«

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ (Web UI)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è¾“å…¥ç¼–è¾‘ â”‚  â”‚ å‚æ•°è°ƒæ•´ â”‚  â”‚ éŸ³é¢‘é¢„è§ˆ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         HTML + CSS + Vanilla JavaScript         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯ (FastAPI Server)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å¯¹è¯åˆ†æ â”‚  â”‚ TTSç”Ÿæˆ  â”‚  â”‚ å·¥ç¨‹ç®¡ç† â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         ai_analyzer.py + tts_generator.py       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†•                  â†•                 â†•
    DeepSeek API    ç«å±±å¼•æ“TTS API      FFmpeg
```

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
dialogue_editor/
â”‚
â”œâ”€â”€ app.py                      # FastAPI WebæœåŠ¡å™¨
â”œâ”€â”€ project_schema.py           # Pydanticæ•°æ®æ¨¡å‹
â”œâ”€â”€ ai_analyzer.py              # AIå¯¹è¯åˆ†æå™¨
â”œâ”€â”€ tts_generator.py            # TTSéŸ³é¢‘ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ static/                     # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html             # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ style.css              # æ ·å¼è¡¨
â”‚   â””â”€â”€ app.js                 # å‰ç«¯é€»è¾‘
â”‚
â”œâ”€â”€ projects/                   # å·¥ç¨‹æ–‡ä»¶å­˜å‚¨ç›®å½•
â”œâ”€â”€ dialogue_output/            # éŸ³é¢‘è¾“å‡ºç›®å½•
â”‚
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–
â”œâ”€â”€ .env.template              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ README.md                  # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ start.ps1                  # å¯åŠ¨è„šæœ¬(PowerShell)
â””â”€â”€ test.py                    # åŠŸèƒ½æµ‹è¯•
```

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. è¾“å…¥å¯¹è¯ (ç”¨æˆ·)
```
ä½ å¥½,æœ€è¿‘æ€ä¹ˆæ ·?
æŒºå¥½çš„,å°±æ˜¯å·¥ä½œæœ‰ç‚¹ç´¯ã€‚
é‚£è¦æ³¨æ„ä¼‘æ¯å•Š!
```

### 2. AIåˆ†æ (DeepSeek)
```json
{
  "speakers": [
    {"id": "speaker_1", "gender": "male", "age_group": "adult"},
    {"id": "speaker_2", "gender": "female", "age_group": "adult"}
  ],
  "dialogues": [
    {"speaker_id": "speaker_1", "text": "ä½ å¥½,æœ€è¿‘æ€ä¹ˆæ ·?", "emotion": "ä¸­æ€§"},
    {"speaker_id": "speaker_2", "text": "æŒºå¥½çš„,å°±æ˜¯å·¥ä½œæœ‰ç‚¹ç´¯ã€‚", "emotion": "ç–²æƒ«"},
    {"speaker_id": "speaker_1", "text": "é‚£è¦æ³¨æ„ä¼‘æ¯å•Š!", "emotion": "å…³å¿ƒ"}
  ]
}
```

### 3. å¯è§†åŒ–ç¼–è¾‘ (Web UI)
- ä¿®æ”¹è¯´è¯äººåç§°å’ŒéŸ³è‰²
- è°ƒæ•´æ¯å¥è¯çš„æƒ…æ„Ÿã€è¯­é€Ÿã€éŸ³é‡ã€éŸ³è°ƒ
- é‡æ–°ç”Ÿæˆå•å¥éŸ³é¢‘

### 4. æ‰¹é‡ç”Ÿæˆ (TTS + FFmpeg)
```
line_000.wav (ä½ å¥½,æœ€è¿‘æ€ä¹ˆæ ·?)
line_001.wav (æŒºå¥½çš„,å°±æ˜¯å·¥ä½œæœ‰ç‚¹ç´¯ã€‚)
line_002.wav (é‚£è¦æ³¨æ„ä¼‘æ¯å•Š!)
       â†“ FFmpegåˆå¹¶
final_merged.wav
```

## ğŸ¯ æ•°æ®æ¨¡å‹

### DialogueProject (å·¥ç¨‹æ–‡ä»¶)
```python
{
    "version": "1.0",
    "title": "å¯¹è¯æ ‡é¢˜",
    "original_text": "åŸå§‹æ–‡æœ¬",
    "speakers": [...],          # è¯´è¯äººåˆ—è¡¨
    "dialogues": [...],         # å¯¹è¯åˆ—è¡¨
    "output_audio": "è·¯å¾„",      # æœ€ç»ˆéŸ³é¢‘
    "created_at": "æ—¶é—´æˆ³",
    "updated_at": "æ—¶é—´æˆ³"
}
```

### Speaker (è¯´è¯äºº)
```python
{
    "id": "speaker_1",
    "name": "å°æ˜",
    "gender": "male|female|child",
    "age_group": "child|teenager|adult|elder",
    "voice_type": "zh_male_..."  # ç«å±±å¼•æ“éŸ³è‰²ID
}
```

### DialogueLine (å¯¹è¯è¡Œ)
```python
{
    "id": "line_1",
    "speaker_id": "speaker_1",
    "text": "å¯¹è¯å†…å®¹",
    "emotion": "å¼€å¿ƒ",              # 24ç§ä¸­æ–‡æƒ…æ„Ÿ
    "speed_ratio": 1.0,            # 0.2-3.0
    "volume_ratio": 1.0,           # 0.1-3.0
    "pitch_ratio": 1.0,            # 0.1-3.0
    "context": "ä¸Šä¸€å¥å¯¹è¯",        # ç”¨äºä¸Šä¸‹æ–‡ç†è§£
    "audio_file": "ç”Ÿæˆçš„éŸ³é¢‘è·¯å¾„",
    "duration": 2.5                # éŸ³é¢‘æ—¶é•¿
}
```

## ğŸ”Œ APIæ¥å£

### åˆ†æå¯¹è¯
```http
POST /api/analyze
Content-Type: application/json

{
  "text": "å¯¹è¯æ–‡æœ¬"
}

Response:
{
  "project_id": "uuid",
  "project": { ... }
}
```

### è·å–é…ç½®
```http
GET /api/config

Response:
{
  "emotions": {
    "chinese": ["å¼€å¿ƒ", "æ‚²ä¼¤", ...],
    "english": [...]
  },
  "voice_types": { ... },
  "tts_params": { ... }
}
```

### æ›´æ–°å¯¹è¯è¡Œ
```http
PUT /api/projects/{project_id}/line/{line_id}
Content-Type: application/json

{
  "emotion": "å¼€å¿ƒ",
  "speed_ratio": 1.2
}
```

### ç”Ÿæˆå…¨éƒ¨éŸ³é¢‘
```http
POST /api/projects/{project_id}/generate

Response:
{
  "success": true,
  "audio_url": "/audio/project_id_final.wav"
}
```

### é‡æ–°ç”Ÿæˆå•å¥
```http
POST /api/projects/{project_id}/generate-line/{line_id}

Response:
{
  "success": true,
  "audio_url": "/audio/line_001.wav"
}
```

### åˆ—å‡ºå·¥ç¨‹
```http
GET /api/projects

Response:
{
  "projects": [
    {
      "id": "uuid",
      "title": "æ ‡é¢˜",
      "created_at": "...",
      "updated_at": "..."
    }
  ]
}
```

## ğŸ¨ UIè®¾è®¡

### é¢œè‰²æ–¹æ¡ˆ
- Primary: `#6366f1` (é›è“)
- Secondary: `#8b5cf6` (ç´«è‰²)
- Success: `#10b981` (ç»¿è‰²)
- Danger: `#ef4444` (çº¢è‰²)
- Background: `#f8fafc` (æµ…ç°)

### äº¤äº’æµç¨‹
1. **æ­¥éª¤1 - è¾“å…¥**: å¤§æ–‡æœ¬æ¡† + AIåˆ†ææŒ‰é’®
2. **æ­¥éª¤2 - ç¼–è¾‘**: è¯´è¯äººå¡ç‰‡ + å¯¹è¯åˆ—è¡¨ + å‚æ•°æ»‘å—
3. **æ­¥éª¤3 - é¢„è§ˆ**: éŸ³é¢‘æ’­æ”¾å™¨ + ä¸‹è½½æŒ‰é’®

### å“åº”å¼è®¾è®¡
- æ¡Œé¢: åŒæ å¸ƒå±€(è¯´è¯äºº + å¯¹è¯)
- å¹³æ¿: å•æ å †å 
- æ‰‹æœº: ç®€åŒ–ç•Œé¢,å‚ç›´æ»šåŠ¨

## ğŸ”§ ä¾èµ–è¯´æ˜

### Pythonä¾èµ– (æœ€å°åŒ–)
- **fastapi** (0.104.0+): Webæ¡†æ¶
- **uvicorn** (0.24.0+): ASGIæœåŠ¡å™¨
- **pydantic** (2.5.0+): æ•°æ®éªŒè¯
- **requests** (2.31.0+): HTTPå®¢æˆ·ç«¯
- **python-multipart** (0.0.6+): æ–‡ä»¶ä¸Šä¼ æ”¯æŒ

### å¤–éƒ¨ä¾èµ–
- **FFmpeg**: éŸ³é¢‘åˆå¹¶(å¿…éœ€)
- **DeepSeek API**: AIåˆ†æ(å¯é€‰)
- **ç«å±±å¼•æ“TTS**: è¯­éŸ³åˆæˆ(å¿…éœ€)

## ğŸš€ å¿«é€Ÿå¼€å§‹

```powershell
# 1. è¿›å…¥ç›®å½•
cd dialogue_editor

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.template ../.env
# ç¼–è¾‘ .env å¡«å…¥å‡­è¯

# 4. å¯åŠ¨æœåŠ¡
.\start.ps1
# æˆ–
python app.py

# 5. è®¿é—®
http://localhost:8000
```

## ğŸ“Š æ€§èƒ½è€ƒè™‘

- **å¹¶å‘**: FastAPIå¼‚æ­¥æ”¯æŒ,å•ä¸ªå¯¹è¯ç”Ÿæˆä¸é˜»å¡
- **ç¼“å­˜**: å·²ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶å¯é‡ç”¨
- **æµå¼**: HTTPæµå¼æ¥å£å‡å°‘ç­‰å¾…æ—¶é—´
- **ä¼˜åŒ–**: ä½¿ç”¨ç«å±±å¼•æ“æ¨èçš„å‚æ•°(24kHzé‡‡æ ·ç‡)

## ğŸ”’ å®‰å…¨æ€§

- APIå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
- å·¥ç¨‹æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ç›®å½•
- æ— ç”¨æˆ·è®¤è¯(å•æœºä½¿ç”¨)
- è¾“å…¥éªŒè¯ä½¿ç”¨Pydantic

## ğŸ›£ï¸ æœªæ¥æ‰©å±•

- [ ] ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- [ ] å·¥ç¨‹åˆ†äº«å’Œåä½œ
- [ ] éŸ³é¢‘æ³¢å½¢å¯è§†åŒ–
- [ ] å®æ—¶é¢„è§ˆå•å¥
- [ ] å¯¼å‡ºSRTå­—å¹•
- [ ] æ”¯æŒæ›´å¤šTTSå¼•æ“
- [ ] æ‰¹é‡å¯¼å…¥CSV
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–

## ğŸ“ å¼€å‘ç¬”è®°

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›æŠ€æœ¯?

1. **FastAPI**: å¿«é€Ÿå¼€å‘,è‡ªåŠ¨APIæ–‡æ¡£,å¼‚æ­¥æ”¯æŒ
2. **Vanilla JS**: é¿å…æ„å»ºå¤æ‚åº¦,é€‚åˆå°å‹é¡¹ç›®
3. **Pydantic**: ç±»å‹å®‰å…¨,è‡ªåŠ¨éªŒè¯,æ˜“äºç»´æŠ¤
4. **FFmpeg**: ä¸šç•Œæ ‡å‡†,åŠŸèƒ½å¼ºå¤§,è·¨å¹³å°

### è®¾è®¡å†³ç­–

- **å•é¡µåº”ç”¨**: å‡å°‘é¡µé¢åˆ·æ–°,æå‡ä½“éªŒ
- **JSONå·¥ç¨‹æ–‡ä»¶**: äººç±»å¯è¯»,ä¾¿äºè°ƒè¯•å’Œç‰ˆæœ¬æ§åˆ¶
- **å¼‚æ­¥TTS**: æ”¯æŒå¤§é‡å¯¹è¯çš„æ‰¹é‡ç”Ÿæˆ
- **æ¨¡å—åŒ–**: å„ç»„ä»¶èŒè´£æ¸…æ™°,æ˜“äºæµ‹è¯•å’Œæ‰©å±•

---

**é¡¹ç›®çŠ¶æ€**: âœ… MVPå®Œæˆ,å¯æŠ•å…¥ä½¿ç”¨

**ä½œè€…**: GitHub Copilot
**æ—¥æœŸ**: 2025å¹´10æœˆ17æ—¥
